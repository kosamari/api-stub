# API Stub

A simple, no database, temporary API for your prototype.  It can be used for front end development, rest service load testing, or ???.  No that's probably about it...

Supports:

* [Multiple stub configurations with variable return types](#stub-scanning)
* [Proxy pass-through for unknown endpoints](#proxy-pass-through)
* Per endpoint configuration of
    * [Response delay](#response-delay) (randomized per request)
        * Ensure your promises are resolving as expected
        * Load test by removing all variables on the data side
    * [Error Rate](#error-rate)
        * Don't just mock out the happy path, build in some errors so you know exactly what happens when server calls fail
    * [Response Headers](#response-headers) (there's also a global option for headers as well)
    * [Data templating](#data-templating)
        * Data the is returned can be generated by the stub server so it appears to be random data

## Quick Start
You will need node.js installed on your machine.
```
npm install api-stub --save-dev
```
```javascript
// api.js
var API = require('api-stub');

var config = {
    endpoints: [{
        path:'/status',
        data: {status: true}
    }]
};

var server = new API(config);
server.start(3000);

//then run the script `node api.js`

```
After you run the script - `node api.js`, http://localhost:3000/status will return following.
```json
{ "status": true }
```
You can put as many endpoints as you'd like in the config array.

### Usage as a docker container

The API-Stub is also available as a Docker image if you do need to run it directly in your project. To get started, create your config file as follows:

```javascript
// api.js
// Notice we are requiring the source directly here. This is important as
// we are running directly from source code inside of the image.
var API = require('./src/api');

var config = {
    endpoints: [{
        path:'/status',
        data: {status: true}
    }]
};

var server = new API(config);
server.start(3000);
```

Then the run your API-Stub container:

```bash
$ docker run -v $(pwd)/api.js:/app/server.js -v $(pwd)/stubs:/app/stubs docker.example.com/punisher/apistub
```

Then your stub server will be available at <docker-host-ip>:3000.

### Stub Scanning

Wait a minute, I don't want a huge file with all of my stubs in it.  No worries, by default api-stub will scan `process.cwd() + /stubs` for `.js` files and add them to the endpoints config.

With the file system below, server.js will automatically pick up item.js & cart.js.

```
.
|
+--server.js
|
+--stubs
|  +--item.js
|  +--cart.js
+--etc
```

What if I like stub scanning, but that path just doesn't work for me?

```
// it's easily configurable
var config = {
    stubsPath: process.cwd() + '/newscanlocation',
    endpoints: [{
        path:'/status',
        data: {status: true}
    }]
};

```

Here's an example of a stub file:
```javascript
// item.js
module.exports = {
  path: '/item',
  delay: {min: 50,max: 50}
  errorRate: .25,
  data: {item: true},
};
```

### Proxy Pass-Through<a name="proxy-pass-through"></a>

If you have a backend answering some requests and only want to stub out a few, you can use the proxy setting.  That will make the API-STUB respond to known endpoints and forward everything else to the specified proxy, copying over all header values.

```javascript
var config = {
    proxy: 'http://www.example.com',
    endpoints: [{
        path:'/status',
        data: {status: true}
    }]
};
```

### Error Rate<a name="error-rate"></a>

Instead of always returning the data you're expecting, API-STUB can be configured to randomly fail the request.  Working with an error rate in place will help keep graceful error handling in mind.  The error rate can be any number between zero and one.

```javascript
// it's easily configurable
var config = {
    endpoints: [{
        path:'/status',
        errorRate: .25
        data: {status: true}
    }]
};

```

### Response Delay<a name="response-delay"></a>

You can add an endpoint specific delay to the response to simulate latency.  The delay setting is milliseconds, takes a min/max and will randomize the delay of each request between those values.  If you want all requests to receive the same delay, simply use the same min/max value.

```javascript
var config = {
    proxy: 'http://www.example.com',
    endpoints: [{
        path:'/fast',
        data: {fast: true}
    },{
        path:'/slow',
        delay: {min: 100, max: 500},
        data: {slow: true}
    }]
};
```

## Headers

Sometimes you need to mock an API, and also need to mock some headers e.g add CORS support.

### Default Headers

In this case, declare your config as an object instead of an array.

These headers will be added to every response

```javascript

var config = {
  defaultHeaders: [
    {
      name: 'Access-Control-Allow-Origin',
      value: '*'
    }
  ],
  endpoints: [
    {
      path:'/status',
      data: {status: true}
    }
  ]
};

```

### Endpoint Specific Headers

You can also add headers to an individual endpoint. These will be applied after any default headers (if applicable)

```javascript
var config = {
  endpoints: [
    {
      path:'/status',
      data: {status: true},
      headers: [
        {
          name: 'My-Header-Name',
          value: 'my header value'
        }
      ]
    }
  ]
};
```

## Repeated dataset
If you need repeated dataset, you can specifying `template` field, and use placeholder text in `data` to set repeated amount.

```javascript
var config = {
  endpoints: [{
  path:'/random',
  data: [/// info * 3 ///] // [templatename] * [how many to repeat]
  templates:{
    info:{
      message:'Hi there!'
    }
  }
}]
};
```
```json
[{ "message": "Hi there!" },{ "message": "Hi there!" },{ "message": "Hi there!" }]
```

## Dynamically generate data
### Built in templates
There are few built in templates to generate data dynamically. (Check Templates section for more)
```javascript
var config = {
  endpoints: [{
  path:'/id',
  data: [/// users * 3 ///]
  templates:{
    users:{
      id:{
        stub_type:'number',
        starting_num:1000,
        increments:1,
        type:'incremental'
      },
    }
  }
}]
};
```
```json
[{ "id": 1000 },{ "id": 1001 },{ "id": 1002 }]
```
### Custom functions
You can also assign your custom function to any key. When initializing API server, API Stub will creates deep copy of `data` & invoke any function assigned.
```javascript
var config = {
  endpoints:[{
  path:'/random',
  data: {value: function(){Math.random();}}
}]
};

```
```json
{ "value": 0.05823205946944654 } // random value everytime you start the serer
```

## API
###server.start(port, [callback])
Start API server on specified port number
###server.stop([callback])
Stop API server
###server.profile()
Returns status of the API server
- status: True if API server is running
- port: port number that API sever is using,
- running_since: timestamp of when the API server started,
- path : list of paths this API server is serving
```
{
  status: true,
  port: 3000,
  running_since: Fri May 15 2015 08:29:21 GMT-0400 (EDT),
  path: [ '/data', '/status' ]
}
```

## Templates
There are 4 `stub_type` .

### select
Select values from given choice.

property | type | value
--- | --- | ---
type | `string` | 'liner', 'random', or 'random_unique'
choice | `array` | array of choices
'liner' will select values from top the the array. 'random' will pick values randomly. 'random_unique' will pick values randomly but will _not_ã€€draw same value twice (must provide enough choices if you are creating repeated dataset).
```
data:{
  stub_type:'select',
  type:'liner',
  choice:[100,200,300,400]
}
```

### number
Numbers in set increments or randomly within specified range

property | type | value
--- | --- | ---
type | `string` | 'incremental' or 'random'
starting_num | `number` | starting value for 'incremental' type
increments | `number` | increment step for 'incremental' type
min_num | `number` | minimum value for 'random' type
max_num | `number` | maximum value for 'random' type
'incremental' will inclement values specified in `increments`. 'random' will pick random values between min_num and max_num.
```
id:{
  stub_type:'number',
  type:'incremental',
  starting_num:1000,
  increments:1
}
```
```
value:{
  stub_type:'number',
  type:'random',
  min_num:1000,
  max_num:5000
}
```

### lipsum
Lorem Ipsum text

property | type | value
--- | --- | ---
min_char_length | `number` | minimum character count
max_char_length | `number` | maximum character count

```
text:{
  stub_type:'lipsum',
  min_char_length:200,
  max_char_length:500,
}
```

### datetime
parse & create datetime related text

property | type | value
--- | --- | ---
type | `string` | 'incremental' or 'random'
starting_datetime | `string` | starting value for 'incremental' type. Pass any string that `Date.parse(str)` can process
increments| `string` | increments for 'incremental' type in milliseconds (`86400000` would be one day)
min_datetime | `string` | minimum date for 'random'. Pass any string that `Date.parse(str)` can process
max_datetime | `string` | maximum date for 'random'. Pass any string that `Date.parse(str)` can process
output_format | `string` | parsing method for Date object (see output_format table below)

```
timestamp:{
  stub_type:'datetime',
  type:'random',
  min_datetime:'2014-01-01',
  max_datetime:'2014-01-31',
  output_format:'toYMDString',
}
```
```
timestamp:{
  stub_type:'date',
  type:'incremental',
  starting_datetime:'2014-01-01',
  increments:86400000,
  output_format:'toTimeString',
}
```

output_format| return
--- | ---
toString | `Fri May 15 2015 09:30:16 GMT-0400 (EDT)`
toDateString | `Fri May 15 2015'`
toISOString | `2015-05-15T13:30:16.411Z`
toJSON | `2015-05-15T13:30:16.411Z`
toGMTString | `Fri, 15 May 2015 13:30:16 GMT`
toLocaleDateString | `5/15/2015`
toLocaleString | `5/15/2015, 9:30:16 AM`
toLocaleTimeString | `9:30:16 AM'`
toTimeString | `09:30:16 GMT-0400 (EDT)'`
toUTCString | `Fri, 15 May 2015 13:30:16 GMT`
toYMDString | `2015-05-15`

## FAQ

### Yet another API mock up tool huh?
Yep. I needed something I can generate unique data easily, quickly modify schema as I go, and avoid set up of database.

### Why there is no <_some feature_ > ?
I have been using this script as part of my dataviz prototyping. While this serves my purpose in what I do, I have not been using it for other applications (i.e consumer app). If you find some key features are missing, I'd love to hear about it.
